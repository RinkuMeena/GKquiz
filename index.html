<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarkari Exam Portal</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --correct: #27ae60;
            --wrong: #e74c3c;
            --bg: #f4f6f9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- LOGIN MODAL (Overlay) --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000;
        }

        .login-box {
            background: white; padding: 30px; border-radius: 12px;
            text-align: center; width: 300px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .login-box h2 { margin-top: 0; color: var(--primary); }
        .login-box input {
            width: 90%; padding: 12px; margin: 15px 0;
            border: 2px solid #ddd; border-radius: 6px; font-size: 1rem;
        }
        .start-btn {
            background: var(--accent); color: white; border: none;
            padding: 12px 25px; border-radius: 6px; cursor: pointer;
            font-size: 1.1rem; width: 100%;
        }

        /* --- DASHBOARD (Top Bar) --- */
        #top-bar {
            background: white; padding: 10px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100;
        }

        .user-info { font-weight: bold; color: var(--primary); }
        .stats-strip { display: flex; gap: 15px; font-size: 0.9rem; }
        .stat-val { font-weight: bold; margin-left: 5px; }
        .s-green { color: var(--correct); }
        .s-red { color: var(--wrong); }

        /* --- MAIN QUIZ AREA --- */
        #main-area {
            flex: 1; overflow-y: auto; padding: 15px;
            scroll-behavior: smooth;
        }

        .container { max-width: 700px; margin: 0 auto; padding-bottom: 60px; }

        .question-card {
            background: white; border-radius: 10px; padding: 15px;
            margin-bottom: 20px; box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .exam-tag {
            background: #e1ecf4; color: #39739d;
            padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700;
        }
        
        .repeat-tag {
            background: #ffebee; color: #c62828; padding: 3px 8px; 
            border-radius: 4px; font-size: 0.75rem; font-weight: 700; margin-left: 5px;
        }

        .q-text { font-size: 1.1rem; font-weight: 600; color: #2c3e50; margin: 10px 0 15px 0; }

        .opt-btn {
            display: block; width: 100%; text-align: left;
            background: white; border: 1.5px solid #e0e0e0;
            padding: 12px; border-radius: 8px; margin-bottom: 8px;
            cursor: pointer; font-size: 0.95rem; color: #444;
        }

        .opt-btn.correct { background: #d4edda; border-color: var(--correct); color: #155724; font-weight: bold; }
        .opt-btn.wrong { background: #f8d7da; border-color: var(--wrong); color: #721c24; }

        .explanation-box {
            margin-top: 10px; padding: 12px; background: #fff3cd;
            border-left: 4px solid #ffc107; border-radius: 4px;
            display: none; font-size: 0.9rem; color: #856404;
        }

        /* Float Buttons */
        .float-btns {
            position: fixed; bottom: 20px; right: 20px;
            display: flex; gap: 10px; z-index: 1000;
        }
        .circle-btn {
            width: 50px; height: 50px; border-radius: 50%; border: none;
            color: white; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex;
            justify-content: center; align-items: center;
        }
        .btn-lang { background: var(--primary); }
        .btn-reset { background: var(--wrong); font-size: 0.8rem; }

    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2>Welcome Student</h2>
            <p>Enter your ID/Name to save progress</p>
            <input type="text" id="username-input" placeholder="Ex: Rinku123">
            <button class="start-btn" onclick="loginUser()">Start Quiz</button>
        </div>
    </div>

    <div id="top-bar">
        <div class="user-info">üë§ <span id="display-name">Guest</span></div>
        <div class="stats-strip">
            <span>Attempted: <span class="stat-val" id="s-total">0</span></span>
            <span>‚úÖ <span class="stat-val s-green" id="s-correct">0</span></span>
            <span>‚ùå <span class="stat-val s-red" id="s-wrong">0</span></span>
        </div>
    </div>

    <div id="main-area">
        <div class="container" id="quiz-list"></div>
        <div style="text-align:center; color:#888; padding:20px;" id="loader">Loading...</div>
    </div>

    <div class="float-btns">
        <button class="circle-btn btn-reset" onclick="resetProgress()" title="Reset All Data">Reset</button>
        <button class="circle-btn btn-lang" onclick="toggleLanguage()">A/‡§Ö</button>
    </div>

<script>
    // --- DATA SECTION (Sample Questions) ---
    // Note: ID must be unique
    const originalDB = [
        { id: 1, exam: "SSC CGL", q_en: "Who is the first citizen of India?", q_hi: "‡§≠‡§æ‡§∞‡§§ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§•‡§Æ ‡§®‡§æ‡§ó‡§∞‡§ø‡§ï ‡§ï‡•å‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opt_en: ["PM", "President", "CJI", "Governor"], opt_hi: ["‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", "‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡§™‡§§‡§ø", "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§®‡•ç‡§Ø‡§æ‡§Ø‡§æ‡§ß‡•Ä‡§∂", "‡§∞‡§æ‡§ú‡•ç‡§Ø‡§™‡§æ‡§≤"], correct: 1, exp_en: "The President is the head of state.", exp_hi: "‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡§™‡§§‡§ø ‡§≠‡§æ‡§∞‡§§ ‡§ï‡•á ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§π‡•à‡§Ç‡•§" },
        { id: 2, exam: "NTPC", q_en: "Which gas is used in chips packets?", q_hi: "‡§ö‡§ø‡§™‡•ç‡§∏ ‡§ï‡•á ‡§™‡•à‡§ï‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§ó‡•à‡§∏ ‡§≠‡§∞‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à?", opt_en: ["Oxygen", "Nitrogen", "Hydrogen", "Argon"], opt_hi: ["‡§ë‡§ï‡•ç‡§∏‡•Ä‡§ú‡§®", "‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§®", "‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•ã‡§ú‡§®", "‡§Ü‡§∞‡•ç‡§ó‡§®"], correct: 1, exp_en: "Nitrogen prevents oxidation.", exp_hi: "‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§® ‡§ö‡§ø‡§™‡•ç‡§∏ ‡§ï‡•ã ‡§ñ‡§∞‡§æ‡§¨ ‡§π‡•ã‡§®‡•á ‡§∏‡•á ‡§¨‡§ö‡§æ‡§§‡•Ä ‡§π‡•à‡•§" },
        { id: 3, exam: "Group D", q_en: "Unit of Force?", q_hi: "‡§¨‡§≤ (Force) ‡§ï‡•Ä ‡§á‡§ï‡§æ‡§à?", opt_en: ["Joule", "Watt", "Newton", "Pascal"], opt_hi: ["‡§ú‡•Ç‡§≤", "‡§µ‡§æ‡§ü", "‡§®‡•ç‡§Ø‡•Ç‡§ü‡§®", "‡§™‡§æ‡§∏‡•ç‡§ï‡§≤"], correct: 2, exp_en: "Newton (N).", exp_hi: "‡§®‡•ç‡§Ø‡•Ç‡§ü‡§® (N)." },
        { id: 4, exam: "CHSL", q_en: "Capital of Australia?", q_hi: "‡§ë‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§≤‡§ø‡§Ø‡§æ ‡§ï‡•Ä ‡§∞‡§æ‡§ú‡§ß‡§æ‡§®‡•Ä?", opt_en: ["Sydney", "Melbourne", "Canberra", "Perth"], opt_hi: ["‡§∏‡§ø‡§°‡§®‡•Ä", "‡§Æ‡•á‡§≤‡§¨‡§∞‡•ç‡§®", "‡§ï‡•à‡§®‡§¨‡§∞‡§æ", "‡§™‡§∞‡•ç‡§•"], correct: 2, exp_en: "Canberra.", exp_hi: "‡§ï‡•à‡§®‡§¨‡§∞‡§æ‡•§" },
        { id: 5, exam: "MTS", q_en: "Hardest substance on Earth?", q_hi: "‡§™‡•É‡§•‡•ç‡§µ‡•Ä ‡§™‡§∞ ‡§∏‡§¨‡§∏‡•á ‡§ï‡§†‡•ã‡§∞ ‡§™‡§¶‡§æ‡§∞‡•ç‡§•?", opt_en: ["Gold", "Iron", "Diamond", "Platinum"], opt_hi: ["‡§∏‡•ã‡§®‡§æ", "‡§≤‡•ã‡§π‡§æ", "‡§π‡•Ä‡§∞‡§æ", "‡§™‡•ç‡§≤‡•à‡§ü‡§ø‡§®‡§Æ"], correct: 2, exp_en: "Diamond.", exp_hi: "‡§π‡•Ä‡§∞‡§æ‡•§" }
        // ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™ ‡§π‡•õ‡§æ‡§∞‡•ã‡§Ç ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§°‡§æ‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç
    ];

    // --- VARIABLES ---
    let currentUser = "";
    let userData = {
        lastIndex: 0,
        stats: { total: 0, correct: 0, wrong: 0 },
        wrongQueue: [] // To store IDs of wrong questions
    };
    
    let currentLang = 'en';
    const BATCH_SIZE = 5;
    const MAX_DOM_SIZE = 20; // Memory cleaner limit
    
    let renderQueue = []; // Questions currently to be shown logic
    let renderedCount = 0; // How many rendered in current session

    // --- 1. LOGIN SYSTEM ---
    function loginUser() {
        const input = document.getElementById('username-input').value.trim();
        if(!input) return alert("Please enter a name");
        
        currentUser = input;
        document.getElementById('display-name').innerText = currentUser;
        document.getElementById('login-screen').style.display = 'none';

        // Load Data from LocalStorage
        const savedData = localStorage.getItem('quiz_data_' + currentUser);
        if(savedData) {
            userData = JSON.parse(savedData);
            alert(`Welcome back, ${currentUser}! Resuming from Q.${userData.lastIndex + 1}`);
        } else {
            // New User
            userData = { lastIndex: 0, stats: { total: 0, correct: 0, wrong: 0 }, wrongQueue: [] };
        }

        updateStatsUI();
        loadNextBatch();
    }

    function saveData() {
        if(currentUser) {
            localStorage.setItem('quiz_data_' + currentUser, JSON.stringify(userData));
        }
    }

    function resetProgress() {
        if(confirm("Are you sure? This will delete all your progress.")) {
            localStorage.removeItem('quiz_data_' + currentUser);
            location.reload();
        }
    }

    // --- 2. QUIZ LOGIC ---
    
    function loadNextBatch() {
        const loader = document.getElementById('loader');
        loader.style.display = 'block';

        // Decide which questions to load
        // We load from originalDB starting at userData.lastIndex
        
        setTimeout(() => {
            let count = 0;
            let dbIndex = userData.lastIndex;

            while(count < BATCH_SIZE) {
                // Priority 1: Check if any Repeated (Wrong) questions are pending?
                // For simplicity in this robust version, we mix them or prioritize them.
                // Let's keep it simple: Linear progress first.
                
                if (dbIndex < originalDB.length) {
                    createCard(originalDB[dbIndex], false);
                    dbIndex++;
                    count++;
                } else {
                    // DB Finished? Check Wrong Queue
                    if(userData.wrongQueue.length > 0) {
                        // Pick a wrong question
                        let wrongId = userData.wrongQueue.shift(); // Take from front
                        let qData = originalDB.find(q => q.id === wrongId);
                        if(qData) createCard(qData, true);
                        // Don't increment dbIndex here as we are in replay mode
                        count++;
                    } else {
                        loader.innerText = "All Questions Completed!";
                        break;
                    }
                }
            }
            
            // Update Global Index only if we progressed in DB
            // (If we are doing repeated questions, lastIndex shouldn't move ideally, 
            // but for simple sync let's update where we are in main DB)
            userData.lastIndex = dbIndex;
            saveData();
            
            cleanMemory();
            if(dbIndex < originalDB.length || userData.wrongQueue.length > 0) loader.style.display = 'none';
        }, 500);
    }

    function createCard(data, isRepeat) {
        const container = document.getElementById('quiz-list');
        const card = document.createElement('div');
        card.className = 'question-card';
        card.setAttribute('data-qid', data.id);

        const repeatHtml = isRepeat ? `<span class="repeat-tag">REVISION</span>` : '';

        card.innerHTML = `
            <div><span class="exam-tag">${data.exam}</span>${repeatHtml}</div>
            <div class="q-text"></div>
            <div class="options-box"></div>
            <div class="explanation-box"></div>
        `;

        // Render Text
        updateCardContent(card, data);

        container.appendChild(card);
    }

    function updateCardContent(card, data) {
        const qText = currentLang === 'en' ? data.q_en : data.q_hi;
        card.querySelector('.q-text').innerText = `Q. ${qText}`;
        
        const optBox = card.querySelector('.options-box');
        optBox.innerHTML = ''; // Clear old

        const opts = currentLang === 'en' ? data.opt_en : data.opt_hi;
        
        // Check if already answered in this DOM session (visual only)
        if(card.classList.contains('answered')) {
             // If answered, just show text, no buttons logic needed for this demo
             // Ideally we lock it.
        }

        opts.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => handleAnswer(card, btn, idx, data);
            optBox.appendChild(btn);
        });

        const expBox = card.querySelector('.explanation-box');
        const expPrefix = currentLang === 'en' ? "Explanation: " : "‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ: ";
        const expContent = currentLang === 'en' ? data.exp_en : data.exp_hi;
        if(card.classList.contains('answered')) {
             expBox.innerHTML = `<strong>${expPrefix}</strong> ${expContent}`;
        }
    }

    function handleAnswer(card, btn, selectedIdx, data) {
        if(card.classList.contains('answered')) return;
        card.classList.add('answered');

        const allBtns = card.querySelectorAll('.opt-btn');
        allBtns.forEach(b => b.disabled = true);

        const expBox = card.querySelector('.explanation-box');
        const expPrefix = currentLang === 'en' ? "Explanation: " : "‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ: ";
        const expContent = currentLang === 'en' ? data.exp_en : data.exp_hi;

        userData.stats.total++;

        if(selectedIdx === data.correct) {
            btn.classList.add('correct');
            userData.stats.correct++;
        } else {
            btn.classList.add('wrong');
            allBtns[data.correct].classList.add('correct');
            userData.stats.wrong++;
            
            // Add to Wrong Queue for later Revision
            // Avoid duplicates in queue
            if(!userData.wrongQueue.includes(data.id)) {
                userData.wrongQueue.push(data.id);
            }
        }

        updateStatsUI();
        saveData(); // Save immediately

        expBox.style.display = 'block';
        expBox.innerHTML = `<strong>${expPrefix}</strong> ${expContent}`;
    }

    function toggleLanguage() {
        currentLang = currentLang === 'en' ? 'hi' : 'en';
        // Reload visible cards text
        const cards = document.querySelectorAll('.question-card');
        cards.forEach(card => {
            const qid = parseInt(card.getAttribute('data-qid'));
            const data = originalDB.find(q => q.id === qid);
            if(data) updateCardContent(card, data);
        });
    }

    function updateStatsUI() {
        document.getElementById('s-total').innerText = userData.stats.total;
        document.getElementById('s-correct').innerText = userData.stats.correct;
        document.getElementById('s-wrong').innerText = userData.stats.wrong;
    }

    function cleanMemory() {
        const cards = document.querySelectorAll('.question-card');
        if(cards.length > MAX_DOM_SIZE) {
            // Remove from top
            for(let i=0; i < cards.length - MAX_DOM_SIZE; i++) {
                cards[i].remove();
            }
        }
    }

    // Infinite Scroll
    const mainArea = document.getElementById('main-area');
    mainArea.addEventListener('scroll', () => {
        if(mainArea.scrollTop + mainArea.clientHeight >= mainArea.scrollHeight - 100) {
            loadNextBatch();
        }
    });

</script>
</body>
</html>
