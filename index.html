<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Server Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #2980b9; --bg: #ecf0f1; --card: #fff; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }

        /* HEADER */
        header { background: #fff; padding: 15px; display: flex; justify-content: space-between; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stats { font-weight: bold; font-size: 0.9rem; }
        .green { color: green; } .red { color: red; }

        /* QUIZ AREA */
        #quiz-container { max-width: 700px; margin: 20px auto; padding: 10px; }
        
        .card { background: var(--card); padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .exam-tag { background: #e0f7fa; color: #006064; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .q-text { font-size: 1.1rem; margin: 10px 0; font-weight: 600; color: #333; }

        .opt-btn { width: 100%; padding: 12px; margin-bottom: 8px; border: 1px solid #ddd; background: #fff; text-align: left; cursor: pointer; border-radius: 5px; }
        .opt-btn:hover { background: #f9f9f9; }
        
        .correct { background: #d4edda !important; border-color: green !important; }
        .wrong { background: #f8d7da !important; border-color: red !important; }

        .exp-box { display: none; margin-top: 10px; background: #fff3cd; padding: 10px; font-size: 0.9rem; border-radius: 5px; }

        /* LOADING */
        #loader { text-align: center; margin-top: 50px; font-size: 1.2rem; color: #666; }

        /* FLOATING BTN */
        .fab { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; width: 50px; height: 50px; border-radius: 50%; border: none; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

<header>
    <div>Server Mode: <span style="color:green">‚óè Live</span></div>
    <div class="stats">
        Total: <span id="s-total">0</span> | 
        <span class="green">‚úî <span id="s-correct">0</span></span> | 
        <span class="red">‚úò <span id="s-wrong">0</span></span>
    </div>
</header>

<div id="loader">Connecting to Server...<br><small>Fetching Questions from Sheet</small></div>
<div id="quiz-container"></div>

<button class="fab" onclick="toggleLang()">A/‡§Ö</button>

<script>
    // ==========================================
    // üëá ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•Ä GOOGLE SHEET ‡§ï‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç üëá
    // ==========================================
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRCPCEpMa6Nj55kQ87O2XRHE0pgL3C1dds7SVxqxk-5Iuh7wJIH00p0Q3LkrD8b9gX_GpM_sHlRenRY/pubhtml";
    // ==========================================

    let allQuestions = [];
    let currentLang = 'en';
    let stats = { total: 0, correct: 0, wrong: 0 };

    // 1. Google Sheet ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§≤‡§æ‡§®‡§æ (The Magic)
    function fetchQuestions() {
        // ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•ã CSV ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§®‡§æ
        let csvUrl = SHEET_URL.replace('/edit#gid=', '/export?format=csv&gid=').replace('/edit?usp=sharing', '/export?format=csv');

        Papa.parse(csvUrl, {
            download: true,
            header: true,
            complete: function(results) {
                // ‡§ñ‡§æ‡§≤‡•Ä ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å ‡§π‡§ü‡§æ‡§®‡§æ
                allQuestions = results.data.filter(row => row.q_en && row.q_en.trim() !== "");
                
                // Shuffle (‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§ø‡§ï‡•ç‡§∏ ‡§ï‡§∞‡§®‡§æ)
                allQuestions.sort(() => Math.random() - 0.5);
                
                document.getElementById('loader').style.display = 'none';
                
                if(allQuestions.length === 0) {
                    alert("Sheet ‡§∏‡•á ‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§π‡•á‡§°‡§∞ (Headers) ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§");
                } else {
                    renderQuestions();
                }
            },
            error: function(err) {
                document.getElementById('loader').innerHTML = "Server Error! Link Check karein.";
                console.error(err);
            }
        });
    }

    // 2. ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ
    function renderQuestions() {
        const container = document.getElementById('quiz-container');
        // ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§≤‡•ã‡§° ‡§® ‡§π‡•ã ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ö‡§≠‡•Ä ‡§™‡§π‡§≤‡•á 50 ‡§¶‡§ø‡§ñ‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç (Infinite Scroll ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡•ú ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)
        const batch = allQuestions.slice(0, 50); 
        
        batch.forEach((q, index) => {
            let card = document.createElement('div');
            card.className = 'card';
            card.dataset.idx = index; // Language toggle ‡§ï‡•á ‡§≤‡§ø‡§è

            // ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§ï‡•ã A,B,C,D ‡§∏‡•á 0,1,2,3 ‡§á‡§Ç‡§°‡•á‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§®‡§æ
            let correctIndex = 0;
            const ansChar = q.correct ? q.correct.toLowerCase().trim() : 'a';
            if(ansChar === 'b') correctIndex = 1;
            if(ansChar === 'c') correctIndex = 2;
            if(ansChar === 'd') correctIndex = 3;

            // HTML ‡§¨‡§®‡§æ‡§®‡§æ
            card.innerHTML = `
                <div class="exam-tag">${q.exam || 'GK'}</div>
                <div class="q-text" id="q-${index}"></div>
                <div class="opt-box" id="opt-${index}"></div>
                <div class="exp-box" id="exp-${index}"></div>
            `;
            container.appendChild(card);

            // ‡§°‡•á‡§ü‡§æ ‡§≠‡§∞‡§®‡§æ
            updateCardLang(card, q, index, correctIndex);
        });
    }

    // 3. ‡§≠‡§æ‡§∑‡§æ ‡§¨‡§¶‡§≤‡§®‡§æ ‡§î‡§∞ ‡§°‡•á‡§ü‡§æ ‡§≠‡§∞‡§®‡§æ
    function updateCardLang(card, q, index, correctIndex) {
        // ‡§™‡•ç‡§∞‡§∂‡•ç‡§®
        const qText = currentLang === 'en' ? q.q_en : q.q_hi;
        card.querySelector(`#q-${index}`).innerText = `Q. ${qText}`;
        
        // ‡§ë‡§™‡•ç‡§∂‡§®‡•ç‡§∏
        const optBox = card.querySelector(`#opt-${index}`);
        const expBox = card.querySelector(`#exp-${index}`);
        
        // ‡§¨‡§ü‡§® ‡§§‡§≠‡•Ä ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç ‡§ú‡§¨ ‡§§‡§ï ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•ã
        if(!card.classList.contains('answered')) {
            optBox.innerHTML = '';
            const opts = [q.opt_a, q.opt_b, q.opt_c, q.opt_d]; // Sheet ‡§ï‡•á ‡§ï‡•â‡§≤‡§Æ
            
            opts.forEach((opt, i) => {
                let btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(card, btn, i, correctIndex, q);
                optBox.appendChild(btn);
            });
        }

        // ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ
        const expText = currentLang === 'en' ? q.exp_en : q.exp_hi;
        expBox.innerHTML = `<strong>Explanation:</strong> ${expText}`;
    }

    // 4. ‡§â‡§§‡•ç‡§§‡§∞ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡§æ
    function checkAnswer(card, btn, clickedIdx, correctIdx, q) {
        if(card.classList.contains('answered')) return;
        card.classList.add('answered');

        const allBtns = card.querySelectorAll('.opt-btn');
        allBtns.forEach(b => b.disabled = true);

        stats.total++;
        if(clickedIdx === correctIdx) {
            btn.classList.add('correct');
            stats.correct++;
        } else {
            btn.classList.add('wrong');
            allBtns[correctIdx].classList.add('correct');
            stats.wrong++;
        }

        document.getElementById('s-total').innerText = stats.total;
        document.getElementById('s-correct').innerText = stats.correct;
        document.getElementById('s-wrong').innerText = stats.wrong;
        
        card.querySelector('.exp-box').style.display = 'block';
    }

    // 5. ‡§≠‡§æ‡§∑‡§æ ‡§¨‡§ü‡§®
    function toggleLang() {
        currentLang = currentLang === 'en' ? 'hi' : 'en';
        document.getElementById('quiz-container').innerHTML = ''; // Clear old
        renderQuestions(); // Re-render all
    }

    // Start App
    if(SHEET_URL === "https://docs.google.com/spreadsheets/d/e/2PACX-1vRCPCEpMa6Nj55kQ87O2XRHE0pgL3C1dds7SVxqxk-5Iuh7wJIH00p0Q3LkrD8b9gX_GpM_sHlRenRY/pubhtml") {
        document.getElementById('loader').innerHTML = "‚ö†Ô∏è Please paste your Google Sheet Link in the code!";
    } else {
        fetchQuestions();
    }

</script>
</body>
</html>


