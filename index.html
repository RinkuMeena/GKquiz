<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExamHub Live Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding-bottom: 80px; }
        header { background: #fff; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .logo { font-weight: 800; color: #2c3e50; }
        .stats { font-weight: bold; font-size: 0.9rem; }
        
        #quiz-container { max-width: 700px; margin: 20px auto; padding: 10px; }
        .card { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 5px solid transparent; }
        
        .q-text { font-size: 1.15rem; font-weight: 600; color: #333; margin: 15px 0; }
        .opt-btn { width: 100%; padding: 12px; margin-bottom: 8px; border: 1px solid #ddd; background: #fff; text-align: left; cursor: pointer; border-radius: 6px; font-size: 1rem; color: #444; transition: 0.2s; }
        .opt-btn:hover { background: #f9f9f9; }
        
        .correct { background: #d4edda !important; border-color: #28a745 !important; color: #155724 !important; }
        .wrong { background: #f8d7da !important; border-color: #dc3545 !important; color: #721c24 !important; }
        
        .exp-box { display: none; margin-top: 15px; background: #fff3cd; padding: 15px; border-radius: 8px; color: #856404; }
        
        #loader { text-align: center; margin-top: 80px; }
        .fab { position: fixed; bottom: 25px; right: 25px; background: #2c3e50; color: white; width: 55px; height: 55px; border-radius: 50%; border: none; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-size: 1rem; }
    </style>
</head>
<body>

<header>
    <div class="logo">ExamHub <span style="color:green; font-size:0.8rem">● Online</span></div>
    <div class="stats">Score: <span id="s-correct">0</span> / <span id="s-total">0</span></div>
</header>

<div id="loader">Loading Questions...</div>
<div id="quiz-container"></div>
<button class="fab" onclick="toggleLang()">A/अ</button>

<script>
    // ✅ लिंक पहले से सेट है
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRCPCEpMa6Nj55kQ87O2XRHE0pgL3C1dds7SVxqxk-5Iuh7wJIH00p0Q3LkrD8b9gX_GpM_sHlRenRY/pub?output=csv";

    let allQuestions = [];
    let currentLang = 'en';
    let stats = { total: 0, correct: 0 };

    function init() {
        Papa.parse(SHEET_URL, {
            download: true,
            header: true,
            skipEmptyLines: true,
            transformHeader: h => h.toLowerCase().trim(), // Headers को clean करता है
            complete: function(results) {
                if (results.data.length > 0) {
                    allQuestions = results.data.filter(q => q.q_en); // खाली Rows हटाएं
                    allQuestions.sort(() => Math.random() - 0.5); // Shuffle
                    document.getElementById('loader').style.display = 'none';
                    renderQuiz();
                } else {
                    alert("Sheet Empty है!");
                }
            },
            error: () => alert("Link Error!")
        });
    }

    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = '';
        
        allQuestions.slice(0, 50).forEach((q, idx) => {
            let card = document.createElement('div');
            card.className = 'card';
            
            // --- SMART LANGUAGE LOGIC (FALLBACK) ---
            // अगर हिंदी टेक्स्ट नहीं मिला, तो इंग्लिश दिखाओ (खाली मत छोड़ो)
            const qText = (currentLang === 'hi' && q.q_hi) ? q.q_hi : q.q_en;
            const expText = (currentLang === 'hi' && q.exp_hi) ? q.exp_hi : q.exp_en;
            
            // Options Logic:
            // अगर Sheet में 'opt_a_hi' नाम का कॉलम है, तो उसे लो, वरना 'opt_a' लो
            let optA = (currentLang === 'hi' && q.opt_a_hi) ? q.opt_a_hi : q.opt_a;
            let optB = (currentLang === 'hi' && q.opt_b_hi) ? q.opt_b_hi : q.opt_b;
            let optC = (currentLang === 'hi' && q.opt_c_hi) ? q.opt_c_hi : q.opt_c;
            let optD = (currentLang === 'hi' && q.opt_d_hi) ? q.opt_d_hi : q.opt_d;

            // Correct Answer logic
            let correctIdx = 0;
            const ans = q.correct ? q.correct.toLowerCase().trim() : 'a';
            if(ans === 'b') correctIdx = 1;
            if(ans === 'c') correctIdx = 2;
            if(ans === 'd') correctIdx = 3;

            card.innerHTML = `
                <div style="font-size:0.8rem; color:#1565c0; font-weight:bold; margin-bottom:5px;">${q.exam || 'GK'}</div>
                <div class="q-text">Q${idx+1}. ${qText}</div>
                <div class="opt-box"></div>
                <div class="exp-box"><strong>${currentLang==='en'?'Explanation':'व्याख्या'}:</strong> ${expText || '-'}</div>
            `;
            
            const optBox = card.querySelector('.opt-box');
            [optA, optB, optC, optD].forEach((opt, i) => {
                if(!opt) return; // अगर ऑप्शन सच में खाली है तो बटन मत बनाओ
                let btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => check(card, btn, i, correctIdx);
                optBox.appendChild(btn);
            });

            container.appendChild(card);
        });
    }

    function check(card, btn, clicked, correct) {
        if(card.classList.contains('done')) return;
        card.classList.add('done');
        const btns = card.querySelectorAll('.opt-btn');
        
        stats.total++;
        if(clicked === correct) {
            btn.classList.add('correct');
            stats.correct++;
            card.style.borderLeftColor = "#28a745";
        } else {
            btn.classList.add('wrong');
            if(btns[correct]) btns[correct].classList.add('correct');
            card.style.borderLeftColor = "#dc3545";
        }
        
        document.getElementById('s-correct').innerText = stats.correct;
        document.getElementById('s-total').innerText = stats.total;
        card.querySelector('.exp-box').style.display = 'block';
    }

    function toggleLang() {
        currentLang = currentLang === 'en' ? 'hi' : 'en';
        renderQuiz();
    }

    init();
</script>
</body>
</html>
